{% load i18n static %}
{% get_current_language as CURRENT_LANGUAGE %}
{% get_available_languages as AVAILABLE_LANGUAGES %}
{% get_language_info_list for AVAILABLE_LANGUAGES as languages %}
<!DOCTYPE html>
<html lang="{{ CURRENT_LANGUAGE }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campus Calm</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{% static 'css/app.css' %}" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="d-flex">
    <nav class="sidebar bg-white border-end">
      <div class="p-3">
        <div class="text-center mb-2">
          <img src="/media/Logo%20Campus%20Calm.png" alt="Campus Calm" class="brand-logo-large">
          <div class="sidebar-panel-title text-muted small">{% trans "Painel do aluno" %}</div>
        </div>
        <div class="mt-3 small text-muted">
          {% blocktrans with name=request.user.name|default:request.user.email %}OlÃ¡, {{ name }}{% endblocktrans %}
        </div>
        <form class="mt-3" method="post" action="{% url 'set_language' %}">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ request.get_full_path }}">
          <label class="form-label small text-muted mb-1" for="language-select">{% trans "Idioma" %}</label>
          {% with current_lang=CURRENT_LANGUAGE|cut:"-"|cut:"_" %}
            <select id="language-select" class="form-select form-select-sm" name="language" onchange="this.form.submit()">
              {% for language in languages %}
                {% with code=language.code|cut:"-"|cut:"_"|lower %}
                  <option value="{{ language.code }}"{% if language.code|cut:"-"|cut:"_" == current_lang %} selected{% endif %}>
                    {% if code == "ptbr" %}ğŸ‡§ğŸ‡·{% elif code == "ptpt" %}ğŸ‡µğŸ‡¹{% elif code == "en" %}ğŸ‡ºğŸ‡¸{% else %}ğŸŒ{% endif %}
                    {{ language.name_local }}
                  </option>
                {% endwith %}
              {% endfor %}
            </select>
          {% endwith %}
        </form>
        <ul class="nav flex-column mt-4">
          <li class="nav-item">
            <a class="nav-link {% if request.path == '/' %}active{% endif %}" href="/">{% trans "Dashboard" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path|slice:":11" == "/onboarding" %}active{% endif %}" href="/onboarding/">{% trans "Onboarding" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path|slice:":10" == "/semestres" %}active{% endif %}" href="/semestres/">{% trans "Semestres" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path|slice:":8" == "/tarefas" %}active{% endif %}" href="/tarefas/">{% trans "Tarefas" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path|slice:":7" == "/agenda" %}active{% endif %}" href="/agenda/">{% trans "Agenda" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path|slice:":11" == "/lembretes" %}active{% endif %}" href="/lembretes/">{% trans "Lembretes" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path|slice:":10" == "/mensagens" %}active{% endif %}" href="/mensagens/">{% trans "Mensagens" %}</a>
          </li>
        </ul>
        <div class="mt-4 pt-3 border-top">
          <form method="post" action="/logout/">
            {% csrf_token %}
            <button class="nav-link text-danger btn btn-link p-0" type="submit">{% trans "Sair" %}</button>
          </form>
        </div>
      </div>
    </nav>

    <main class="content flex-grow-1">
      <div class="container-fluid py-4">
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags|default:"info" }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="{% trans "Fechar" %}"></button>
            </div>
          {% endfor %}
        {% endif %}
        {% block content %}{% endblock %}
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
